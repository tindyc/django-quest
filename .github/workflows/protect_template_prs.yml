name: Protect Template Repository (Auto-Close PRs)

on:
  pull_request:
    types: [opened, reopened]

jobs:
  autoclose_pr:
    runs-on: ubuntu-latest

    steps:
      - name: Check if this is the main template repo
        id: check
        run: |
          # Replace with YOUR actual template repo path if it ever changes
          TEMPLATE_REPO="tindyc/django-quest"

          if [[ "${GITHUB_REPOSITORY}" == "$TEMPLATE_REPO" ]]; then
            echo "in_template=true" >> $GITHUB_OUTPUT
          else
            echo "in_template=false" >> $GITHUB_OUTPUT
          fi

      - name: Auto-close pull request in template repo
        if: steps.check.outputs.in_template == 'true'
        uses: peter-evans/close-pull@v3
        with:
          pull-request-number: ${{ github.event.pull_request.number }}
          comment: |
            ðŸ‘‹ **Thanks for your Pull Request!**

            This repository is a **Template** for the Django Setup Quest,
            and it is not intended for completing the workshop directly.

            To do the Quest:

            1. Go back to this repoâ€™s main page  
            2. Click **Use this template â†’ Create a new repository**  
            3. Clone *your own* new repository  
            4. Start by creating **Issue 1** in your repo and following the instructions there

            This PR has been closed automatically to keep the template clean.  
            Please repeat your changes in *your own* Django Quest repo. ðŸš€
